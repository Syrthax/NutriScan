<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NutriScan - Food Scanner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- HTML5-QRCode Library -->
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="h-screen flex flex-col text-gray-800 bg-gray-50 font-sans">

    <!-- 1. SCANNER VIEW -->
    <div id="scan-view" class="relative h-full w-full flex flex-col bg-black">
        <div id="reader" class="absolute inset-0 z-0"></div>

        <!-- Top Bar (Gradient Overlay) -->
        <div class="absolute top-0 left-0 right-0 z-20 p-6 flex justify-between items-start bg-gradient-to-b from-black/70 via-black/30 to-transparent pointer-events-none h-32">
            <div class="text-white pointer-events-auto">
                <div class="flex items-center gap-2 mb-1">
                    <div class="bg-green-500 p-1.5 rounded-lg">
                        <i data-lucide="scan-line" class="w-5 h-5 text-white"></i>
                    </div>
                    <h1 class="font-bold text-xl tracking-tight">NutriScan</h1>
                </div>
                <p class="text-xs text-gray-300 font-medium opacity-90">Point camera at any barcode</p>
            </div>
            
            <!-- Top Right Controls -->
            <div class="flex gap-3 pointer-events-auto">
                <button onclick="toggleTorch()" id="torch-btn" class="hidden bg-white/10 backdrop-blur-md border border-white/20 p-3 rounded-full text-white hover:bg-white/20 transition active:scale-95">
                    <i data-lucide="zap" class="w-5 h-5 fill-current"></i>
                </button>
                <button onclick="showInfoModal()" class="bg-white/10 backdrop-blur-md border border-white/20 p-3 rounded-full text-white hover:bg-white/20 transition active:scale-95">
                    <i data-lucide="info" class="w-5 h-5"></i>
                </button>
            </div>
        </div>

        <!-- Viewfinder Area -->
        <div class="absolute inset-0 z-10 flex items-center justify-center pointer-events-none">
            <div class="w-72 h-72 relative">
                <!-- Corners -->
                <div class="absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-white rounded-tl-2xl shadow-sm"></div>
                <div class="absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-white rounded-tr-2xl shadow-sm"></div>
                <div class="absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-white rounded-bl-2xl shadow-sm"></div>
                <div class="absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-white rounded-br-2xl shadow-sm"></div>
                
                <!-- Laser Animation -->
                <div class="scan-laser"></div>
                
                <!-- Hint Text -->
                <div class="absolute -bottom-12 left-0 right-0 text-center">
                    <span class="inline-block bg-black/50 backdrop-blur-md text-white/90 text-xs font-medium px-3 py-1.5 rounded-full border border-white/10">
                        Tap circle to snap & scan
                    </span>
                </div>
            </div>
        </div>

        <!-- Bottom Controls (Glassmorphism) -->
        <div class="absolute bottom-0 left-0 right-0 z-20 bg-gradient-to-t from-black/90 via-black/60 to-transparent pb-10 pt-12 px-6 flex flex-col items-center gap-6">
            
            <!-- Zoom Control -->
            <div id="zoom-controls" class="hidden w-full max-w-xs flex items-center gap-4 pointer-events-auto px-4">
                <i data-lucide="minus" class="w-4 h-4 text-white/60"></i>
                <input type="range" id="zoom-slider" min="1" max="5" step="0.1" value="1" class="flex-1 shadow-lg" oninput="handleZoom(this.value)">
                <i data-lucide="plus" class="w-4 h-4 text-white/60"></i>
            </div>

            <!-- Main Actions Row -->
            <div class="flex items-center justify-between w-full max-w-sm pointer-events-auto px-2">
                
                <!-- Manual Entry Button -->
                <button onclick="showManualEntry()" class="flex flex-col items-center gap-1 text-white/80 hover:text-white transition active:scale-95 group">
                    <div class="w-12 h-12 rounded-full bg-white/10 backdrop-blur-sm border border-white/10 flex items-center justify-center group-hover:bg-white/20">
                        <i data-lucide="keyboard" class="w-5 h-5"></i>
                    </div>
                    <span class="text-[10px] font-medium tracking-wide">Manual</span>
                </button>

                <!-- Shutter Button -->
                <button onclick="captureAndScan()" class="shutter-btn mx-4" id="snap-btn" aria-label="Snap Photo">
                    <div class="shutter-inner"></div>
                </button>

                <!-- Gallery Button -->
                <button onclick="triggerFileInput()" class="flex flex-col items-center gap-1 text-white/80 hover:text-white transition active:scale-95 group">
                    <div class="w-12 h-12 rounded-full bg-white/10 backdrop-blur-sm border border-white/10 flex items-center justify-center group-hover:bg-white/20">
                        <i data-lucide="image" class="w-5 h-5"></i>
                    </div>
                    <span class="text-[10px] font-medium tracking-wide">Gallery</span>
                </button>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="processing-overlay" class="hidden absolute inset-0 z-50 bg-black/80 flex items-center justify-center backdrop-blur-lg transition-all duration-300">
            <div class="text-center p-8">
                <div class="relative w-16 h-16 mx-auto mb-6">
                    <div class="absolute inset-0 border-4 border-white/20 rounded-full"></div>
                    <div class="absolute inset-0 border-4 border-green-500 rounded-full border-t-transparent animate-spin"></div>
                </div>
                <h3 class="text-white font-bold text-xl mb-1" id="processing-text">Analyzing...</h3>
                <p class="text-white/50 text-sm mb-6">Reading barcode details</p>
                <button onclick="cancelProcessing()" class="px-6 py-2 rounded-full bg-white/10 hover:bg-white/20 text-white text-sm font-medium transition pointer-events-auto">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Hidden Input -->
    <input type="file" id="hidden-file-input" accept="image/*" class="hidden" onchange="handleFileScan(this)">

    <!-- 2. RESULTS VIEW -->
    <div id="result-view" class="hidden fixed inset-0 bg-gray-50 flex flex-col overflow-hidden z-30 animate-fade-in">
        
        <!-- Header -->
        <div class="bg-white/80 backdrop-blur-md shadow-sm border-b border-gray-100 px-4 py-3 z-10 flex justify-between items-center sticky top-0">
            <div class="flex items-center gap-2">
                <div class="bg-green-100 p-1.5 rounded-lg">
                    <i data-lucide="check-circle" class="w-4 h-4 text-green-700"></i>
                </div>
                <h2 class="font-bold text-gray-800 text-sm tracking-wide uppercase">Product Found</h2>
            </div>
            <button onclick="resetApp()" class="text-xs font-bold bg-gray-900 text-white px-4 py-2 rounded-full shadow-md hover:bg-gray-800 transition flex items-center gap-2 active:scale-95">
                <i data-lucide="scan-line" class="w-3 h-3"></i> Scan New
            </button>
        </div>

        <main class="flex-1 overflow-y-auto p-4 space-y-5 no-scrollbar">
             <!-- Hero Product Card -->
             <div class="bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden">
                <div class="relative h-64 bg-gradient-to-b from-gray-50 to-white flex items-center justify-center p-6">
                    <img id="product-image" src="" alt="Product" class="h-full w-full object-contain drop-shadow-xl transition-transform hover:scale-105 duration-300">
                    <div id="nutriscore-badge" class="absolute top-4 right-4 px-3 py-1.5 rounded-full text-xs font-bold shadow-sm uppercase tracking-wider border border-white/20 backdrop-blur-sm">
                        Score: <span id="score-val">?</span>
                    </div>
                </div>
                <div class="p-6">
                    <div class="flex items-start justify-between gap-4 mb-2">
                        <div>
                            <p id="product-brand" class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Brand</p>
                            <h2 id="product-name" class="text-2xl font-extrabold text-gray-900 leading-tight">Product Name</h2>
                        </div>
                        <div id="veg-status-icon" class="hidden mt-1 flex-shrink-0 bg-gray-50 p-1 rounded-md"></div>
                    </div>
                    
                    <div class="flex gap-2 flex-wrap mt-4" id="tags-container">
                        <!-- Tags injected here -->
                    </div>
                </div>
            </div>

            <!-- Origin Info -->
            <div id="origin-section" class="hidden bg-blue-50/50 rounded-2xl p-4 border border-blue-100 flex items-start gap-3">
                <div class="bg-blue-100 p-2 rounded-full text-blue-600 shrink-0">
                    <i data-lucide="globe" class="w-4 h-4"></i>
                </div>
                <div>
                    <h3 class="font-bold text-blue-900 text-xs uppercase tracking-wide mb-0.5">Origin / Manufacturing</h3>
                    <p id="product-origin" class="text-sm text-blue-800 font-medium leading-snug"></p>
                </div>
            </div>

            <!-- Nutrition Grid -->
            <div>
                <h3 class="font-bold text-gray-800 text-lg mb-3 px-1">Nutrition Facts <span class="text-xs font-normal text-gray-400 ml-1">per 100g</span></h3>
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex flex-col items-center justify-center gap-1">
                        <div class="bg-orange-50 p-2 rounded-full text-orange-600 mb-1"><i data-lucide="flame" class="w-4 h-4"></i></div>
                        <p class="text-gray-400 text-[10px] uppercase font-bold tracking-wide">Energy</p>
                        <p class="text-xl font-bold text-gray-900"><span id="val-cal">--</span> <span class="text-xs font-normal text-gray-500">kcal</span></p>
                    </div>
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex flex-col items-center justify-center gap-1">
                        <div class="bg-pink-50 p-2 rounded-full text-pink-600 mb-1"><i data-lucide="candy" class="w-4 h-4"></i></div>
                        <p class="text-gray-400 text-[10px] uppercase font-bold tracking-wide">Sugar</p>
                        <p class="text-xl font-bold text-gray-900"><span id="val-sugar">--</span> <span class="text-xs font-normal text-gray-500">g</span></p>
                    </div>
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex flex-col items-center justify-center gap-1">
                        <div class="bg-yellow-50 p-2 rounded-full text-yellow-600 mb-1"><i data-lucide="droplet" class="w-4 h-4"></i></div>
                        <p class="text-gray-400 text-[10px] uppercase font-bold tracking-wide">Fat</p>
                        <p class="text-xl font-bold text-gray-900"><span id="val-fat">--</span> <span class="text-xs font-normal text-gray-500">g</span></p>
                    </div>
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex flex-col items-center justify-center gap-1">
                        <div class="bg-blue-50 p-2 rounded-full text-blue-600 mb-1"><i data-lucide="dumbbell" class="w-4 h-4"></i></div>
                        <p class="text-gray-400 text-[10px] uppercase font-bold tracking-wide">Protein</p>
                        <p class="text-xl font-bold text-gray-900"><span id="val-protein">--</span> <span class="text-xs font-normal text-gray-500">g</span></p>
                    </div>
                </div>
            </div>

            <!-- Ingredients -->
            <div class="bg-white rounded-3xl shadow-sm p-6 border border-gray-100 pb-10">
                <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2 text-lg">
                    <i data-lucide="scroll-text" class="w-5 h-5 text-green-600"></i> Ingredients
                </h3>
                <p id="product-ingredients" class="text-sm text-gray-600 leading-relaxed">No ingredients listed.</p>
            </div>
            
            <div class="h-12"></div>
        </main>
    </div>

    <!-- Info Modal -->
    <div id="info-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeInfoModal()"></div>
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl relative z-10 transform transition-all scale-100">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-900">About NutriScan</h3>
                <button onclick="closeInfoModal()" class="p-1 rounded-full hover:bg-gray-100 text-gray-500">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            
            <div class="space-y-4 text-sm text-gray-600">
                <div class="flex gap-3 items-start">
                    <div class="bg-blue-50 p-2 rounded-lg text-blue-600 shrink-0 mt-0.5">
                        <i data-lucide="wifi" class="w-4 h-4"></i>
                    </div>
                    <p><strong>Internet Required:</strong> This app needs an active internet connection to fetch product details.</p>
                </div>

                <div class="flex gap-3 items-start">
                    <div class="bg-orange-50 p-2 rounded-lg text-orange-600 shrink-0 mt-0.5">
                        <i data-lucide="database" class="w-4 h-4"></i>
                    </div>
                    <p><strong>Data Source:</strong> We use the <em>Open Food Facts</em> database. While extensive, it may not contain every product.</p>
                </div>

                <div class="flex gap-3 items-start">
                    <div class="bg-red-50 p-2 rounded-lg text-red-600 shrink-0 mt-0.5">
                        <i data-lucide="alert-triangle" class="w-4 h-4"></i>
                    </div>
                    <p><strong>Disclaimer:</strong> Data is user-contributed and may contain errors. Always verify with the physical package label before consumption.</p>
                </div>
            </div>

            <button onclick="closeInfoModal()" class="w-full mt-6 bg-gray-900 text-white font-bold rounded-xl py-3.5 shadow-lg hover:bg-black transition transform active:scale-95">Got it</button>
        </div>
    </div>

    <!-- Manual Entry Modal -->
    <div id="manual-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeManualEntry()"></div>
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl relative z-10 transform transition-all scale-100">
            <div class="text-center mb-6">
                <div class="bg-gray-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i data-lucide="keyboard" class="w-6 h-6 text-gray-600"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900">Enter Barcode</h3>
                <p class="text-sm text-gray-500 mt-1">Type the EAN/UPC number</p>
            </div>
            
            <input type="number" id="manual-code-input" placeholder="e.g. 8901234567890" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-4 text-lg text-center mb-6 outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent font-mono tracking-widest transition-all">
            
            <div class="flex gap-3">
                <button onclick="closeManualEntry()" class="flex-1 py-3.5 text-gray-600 font-semibold hover:bg-gray-50 rounded-xl transition">Cancel</button>
                <button onclick="submitManualCode()" class="flex-1 bg-gray-900 text-white font-bold rounded-xl py-3.5 shadow-lg hover:bg-black transition transform active:scale-95">Search</button>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="error-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeErrorModal()"></div>
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl relative z-10 text-center">
            <div class="bg-red-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                <i data-lucide="package-x" class="w-8 h-8 text-red-500"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">Product Not Found</h3>
            <p class="text-gray-500 mb-6 text-sm leading-relaxed" id="error-msg">We couldn't find details for this barcode in our global database.</p>
            <button onclick="closeErrorModal()" class="w-full bg-gray-900 text-white font-bold rounded-xl py-3.5 shadow-lg hover:bg-black transition transform active:scale-95">Try Again</button>
        </div>
    </div>

    <!-- Custom Script -->
    <script src="script.js"></script>
</body>
</html>
